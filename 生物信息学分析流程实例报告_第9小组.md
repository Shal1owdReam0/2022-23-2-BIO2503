# 生物信息学分析流程实例报告

### EB-FAPI+抗PD-L1抗体处理小鼠肿瘤细胞差异表达分析

项目上传至https://github.com/Shal1owdReam0/2022-23-2-BIO2503

第9小组：陈彦宁、刘雅婷、邵逸飞

[TOC]

## 摘要：

​		使用EB-FAPI+抗PD-L1抗体处理携带MC38肿瘤的小鼠。治疗1、3和7天后，收集肿瘤组织并进行高通量测序。用生理盐水未处理的小鼠细胞作为对照。每个治疗组有3个重复。对高通量测序的结果进行差异表达分析，分析EB-FAPI+抗PD-L1治疗对小鼠肿瘤组织中基因表达的影响。

## 一、背景介绍

​		EB-FAPI（也称为CXCR4-targeted FAPI）是一种新型的肿瘤靶向疗法，它基于靶向CXCR4受体的分子设计。CXCR4是一种趋化因子受体，广泛表达于多种癌症类型中，包括肺癌、胃癌、乳腺癌和结直肠癌等。抗PD-L1抗体是一类免疫检查点抑制剂，用于增强患者免疫系统对肿瘤的攻击能力。PD-L1是一种免疫调节分子，其高表达与许多肿瘤类型的逃避免疫监视相关。MC38肿瘤细胞是一种常用的小鼠结直肠癌细胞系，在肿瘤研究领域得到广泛应用。MC38细胞具有较高的异质性，可以模拟人类结直肠癌的特征。在这项研究中，研究人员通过对携带 MC38 肿瘤的小鼠进行 EB-FAPI 和抗PD-L1抗体治疗，并收集肿瘤组织样本进行高通量测序。我们小组希望通过差异表达分析，尝试识别出与治疗效果相关的基因，并探究这些治疗方法对基因表达的影响。

## 二、工作思路及概要

1.质控和预处理：对肿瘤组织样本测序数据进行质量控制，去除低质量的读段。

2.对比到参考基因组：将治疗组和对照组的测序数据与参考基因组进行比对，以获得每个基因的表达量。

3.差异表达分析：使用统计学方法，比较不同时间点的治疗组与对照组之间的差异表达基因，进行统计显著性分析。

## 三、数据集与方法

### 1.数据下载与格式转换

数据来源：https://www.ncbi.nlm.nih.gov/sra

#### sratoolkit

`sratoolkit`是NCBI提供的下载工具，本项目通过如下命令下载数据集：

```bash
wget https://ftp-trace.ncbi.nlm.nih.gov/sra/sdk/current/sratoolkit.current-ubuntu64.tar.gz
tar -zxvf sratoolkit.current-ubuntu64.tar.gzecho 'export export PATH=$PATH:/home/yfshao/sratoolkit.3.0.5-ubuntu64/bin' >> ~/.bash_profile
source ~/.bash_profile
```

#### prefetch

利用`prefetch`命令下载文件：

```bash
prefetch --option-file SRR_Acc_List.txt
```

其中，`SRR_Acc_List.txt`文件包含多条测序的唯一编号。

使用`sratoolkit`提供的工具将sra文件转换成便于数据处理的`fastq`文件：

```bash
fastq-dump --split-3 -t 16 SRRxxxxxxxxx.sra
```

其中，`--split-3`表示拆解成双端测序结果并分别存放。

#### 文件格式

```bash
head -n -20 SRRxxxxxxxx.fastq
```

从而可以看到`fastq`文件格式形如：

```bash
@SRR24942081.1 A00312:299:HLNFGDSX3:3:1101:3459:1000 length=150
AAGGCATTGTCTGAAGGTGAAATGGATAGCTCTGCAACGTCCTCTTAATTCTACACTGGTGAGTAGCGCACAAAGAGGTTGGTCAGCTCGATGGACGGAGGCGGGGCCCAAGTGACCCGCATCGTGTCTGGACAGATATTGGTGAATCTC
+SRR24942081.1 A00312:299:HLNFGDSX3:3:1101:3459:1000 length=150
F,:,FFFF,,,FFF:,F,::F,,,,FFFFF:FFF,::FFFFF:F,F,FFFFF,::F,:,FFFFFF,F:FFF,F::FFFFF::F:F,,FF,F:::F:F,F:,F::F,F:F:F,,,FF:F:FF,F,,,FFF:FFF,FF:FF:FFF,FFFF,:
```

第一行为该read的唯一ID和描述信息；

第二行为该read的碱基序列；

第四行为碱基的测序质量分数，以不同的质量编码方式解析会得到不同的结果。对于该序列，采用`IIIumina 1.8`的规则编码，F表示质量分数为37，','表示质量分数为44，':'表示质量分数为58，序列的质量较高。

### 2.质量控制

#### 虚拟环境

使用已配置的`conda`创建虚拟环境：

```bash
conda create -n RNA-Seq
conda activate RNA-Seq
conda config --add channels bioconda
```

#### 质量分析

`fastqc`是一个常用的质控工具，按照如下命令安装：

```bash
conda install fastqc
```

使用`fastqc`做质量分析：

```bash
fastqc -t 16 -o ./fastqc_result ./SRR24942104_1.fastq
```

`-t 16` 表示使用16个线程进行分析 

`-o ./fastqc_res`表示结果保存到当前目录下的`fastqc_result`路径中

`./SRRXXXXXXXX_1.fastq` 需要分析的`fastq`文件路径

根据`fastqc`得到的报告可知，前15个位置的碱基质量较差

#### 修剪和过滤

安装`trimmomatic`，由于我们的数据是双端测序的结果，故使用如下命令：

```bash
trimmomatic PE -phred33 \
SRR24942081_1.fastq SRR24942081_2.fastq \
SRR24942081_1.trim.fastq SRR24942081_1.unpaired.trim.fastq \
SRR24942081_2.trim.fastq SRR24942081_2.unpaired.trim.fastq \
HEADCROP:15 LEADING:3 TRAILING:3 SLIDINGWINDOW:4:15 MINLEN:36
```

​		其中，`PE` 指定输入文件为`Paired-End`测序数据，`-phred33`指定输入数据的质量分数编码方式为`Phred+33`。同时，移除R1和R2的前15个碱基并从R1和R2开头和结尾移除质量值低于3的碱基，丢弃长度小于36的片段。

### 3.比对到参考基因组

安装`hisat2`：

```bash
conda install hisat2
```

下载对应的参考基因组，并使用`hisat2`建立索引：

```bash
hisat2-build GCF_000001635.27_GRCm39_genomic.fna reference_index
```

将测序结果比对到参考基因组：

```bash
hisat2 -x reference_index -1 SRRXXXXXXXX_1.trim.fastq -2 SRRXXXXXXXX_2.trim.fastq -S
```

至此，我们得到存储了测序读取比对信息的`sam`文件。

### 4.计算基因表达矩阵

安装`samtools`：

```bash
sudo apt-get update
sudo apt install samtools
```

将`sam`文件转换成`bam`文件后进行排序。

`bam`文件以二进制形式储存，储存效率更高，处理速度更快，并且具有更好的工具兼容性，因此这里对BAM文件进行排序，使相同染色体上的片段按照基因组位置从小到大的顺序排列。目的是更高效地利用存储空间，并且提高其基因组分析工具的性能，命令如下：

```bash
samtools view -bS output.sam > output.bam
samtools sort output.bam -o output.sorted.bam
```
安装`featureCounts`：

```bash
wget https://nchc.dl.sourceforge.net/project/subread/subread-2.0.3/subread-2.0.3-Linux-x86_64.tar.gz
tar zxcf subread-2.0.3-Linux-x86_64.tar.gz
```

计算基因表达矩阵：

```bash
featureCounts -a GCF_000001635.27_GRCm39_genomic.gff -p -g gene -o  output_counts.txt *.sorted.bam
```

至此，我们得到了一个包含基因名称和相应表达值的矩阵（基因表达矩阵）和一个包含关于每个样本的信息（对照或处理）的样本注释文件，便于后续进行差异分析。

### 5.差异表达分析

​		在差异表达分析模块，本项目首先将数据矩阵和样本信息矩阵导入，并检查基因表达量和样本信息是否匹配，考虑到表达量过低相对来说意义不大，因此过滤在所有重复样本中小于1的基因，之后再进行差异分析。

​		我们借助常用的差异表达分析工具`DESeq2`包中的`DESeqDataSetFromMatrix`函数将基因表达矩阵和样本信息创建成`DESeq2`对象。在`DESeq2`对象中，基因读数信息和样本信息被整合，并进行标准化和归一化处理，使用`DESeg`函数估计每个基因的样本间离散度来计算基因表达的差异，利用`Wald`检验或者似然比检验对每个基因进行显著性测试，从而得到基因的差异表达水平，对显著性测试结果进行多重检验校正，常见的方法包括`Bonferroni`校正、`Benjamini-Hochberg`校正等，并使用`na.omit`函数去除含有缺失值（NA）的行。

​		在差异表达分析中，`padj`是经过多重检验校正后的`p-value`值，用于控制假阳性的发生率。通常，我们会选择具有显著差异的基因，即`padj`值小于等于某个阈值（例如0.05）的基因作为显著差异表达基因。而`log2FC`则是基因表达量的对数折叠变化，表示两个条件（如不同处理组）之间的表达量差异的倍数。例如，若`log2FC`为1，则意味着在两个条件之间，基因的表达量相差2的1次方，即为2倍的差异。一般来说，我们会将`log2FC`大于1或小于-1作为阈值来判断基因的上调或下调表达，其中大于1表示上调表达，小于-1表示下调表达。因此我们利用Padj值和log2FC对差异基因进行筛选，将`foldChange`设置为1，表示选择差异倍数大于等于1的基因，即包括所有差异表达的基因，将`padj`设置为0.05，表示选择经过多重检验校正后的p-value小于0.05，即具有统计上的显著差异的基因。

​		至此，我们得到了基因表达量差异分析的总分析结果，主要包括`log2FoldChange`、`pvalue`和`padj`等用于描述基因差异表达的统计指标。其中，三者的具体含义如下：

- `log2FoldChange`（对数折叠变化）：
  - `log2FoldChange`表示基因在不同条件（例如不同处理组）之间的表达量差异的对数折叠变化。
  - 正值表示上调表达，即基因在条件A中相对于条件B有增加的表达量。
  - 负值表示下调表达，即基因在条件A中相对于条件B有减少的表达量。
  - 零值表示基因在条件A和条件B之间没有差异表达。

- `pvalue`（原始p值）：
  - `pvalue`表示差异表达的统计显著性，它衡量在两个条件之间基因差异的可信度。
  - 较小的`pvalue`表示差异表达具有更高的统计显著性。
  - 通常使用统计检验（如Wald检验或似然比检验）计算得到。

- `padj`（校正后的p值）：
  - `padj`是在进行多重检验校正后的调整p值，用于控制假阳性的发生率。
  - 多重检验校正方法（如Bonferroni校正、Benjamini-Hochberg校正）会对原始p值进行校正，以减少由于多次比较而产生的误报。
  - 通常，我们会选择具有较小的`padj`值（通常设定为0.05）的基因作为显著差异表达的基因。一般情况下选用`padj`如果差异基因较少，可以用`pvalue`扩大范围。

​        总的来说，`log2FoldChange`表示基因表达量在不同条件之间的差异倍数，用于描述差异的方向和程度，`pvalue`表示差异表达的原始统计显著性，而`padj`表示经过多重检验校正后的统计显著性，用于筛选显著差异表达的基因。

## 四、结果展示

​		为了更直观地展示差异表达结果，我们通过绘制火山图、热图和PCA主成分分析图对结果进行可视化。

​		对于火山图，我们将基因分为notsig（非显著差异）、up（上调表达）和down（下调表达）三大类，并对差异表达基因调整后的p值进行排序，然后以`log2FoldChange`为横坐标，`-log10`后的padj值为纵坐标，绘制火山图。为了更清楚地展示结果，我们把每个基因的点都加上标签，由于太多点重叠导致运行时图像无法显示，因此我们尝试只显示我们需要的基因标签，即在上调和下调基因中各取前5个基因进行可视化，结果如下图所示。

​		其中，横坐标表示基因的表达差异，纵坐标表示统计显著性水平，红色表示上调基因，绿色表示下调基因。可以看出，`Hbb-bt、Epha7`等基因的表达差异较大，`Ccng1、Fmod`等基因的差异表达在统计上更显著。

![image-20230621164053149](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20230621164053149.png)

​		对于热图，我们首先利用`Padj`值和`logFC`值筛选和提取差异基因，然后添加标签信息，分为含有3个样本的实验组（`treated`）和含有3个样本的对照组（`untreated`），再使用`scale()`函数对差异基因表达矩阵进行标准化，绘制热图。热图的行表示基因，列表示样本，用不同颜色表示差异基因的表达模式，颜色的亮度和数字反映基因的相对表达水平，同时显示样本的标签和基因名称。由于基因数量较多，图片太长，因此这里只显示部分结果，如下图所示。

​		其中，颜色较亮的区域表示基因在相应样本中具有较高的表达，而颜色较暗的区域表示较低的表达。通过比较不同样本之间的颜色差异，可以判断基因在不同样本中的表达差异程度。颜色差异越大，表示样本间的基因表达差异越显著。通过观察行之间的颜色模式，可以评估基因之间的相关性。如果一组基因在不同样本中的表达模式相似，那么它们可能在功能上相关或共同参与某个生物过程。

![image-20230621164119550](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20230621164119550.png)

​		对于PCA主成分分析，我们使用`prcomp()`函数对差异基因的表达量矩阵进行分析，设置主成分1（PC1）和主成分2（PC2）为x轴和y轴，将样本名称作为颜色映射，生成一个PCA的散点图，展示主成分1和主成分2之间的样本分布，并根据样本类型使用不同的颜色标记。同时，通过椭圆表示样本的分布情况。结果如下图所示。

![image-20230621164038062](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20230621164038062.png)

​		PCA（主成分分析）是一种常用的降维方法，用于分析多个基因在样本间的表达差异，并将其投影到一个较低维度的空间中。图中，PC1轴的样本间距离较小，而PC2轴的样本间距离较大，即在该主成分方向上的基因表达差异可能对样本间差异起到重要作用。除Sample75以外，其余几个样本在PC1轴上较为靠近，说明样本之间可能存在一定的聚类关系。


## 五、总结与分析讨论

​		生物信息学流程分析的关键在于，对于选定的数据，能够根据数据质控报告选择合适的质量控制方法，提高测序结果。本项目通过质控和预处理、对比分析和差异表达分析实现了一套较为完整的分析流程。存在的不足之处如下：

- 对生物信息学流程分析的常用软件缺少了解。
  		在使用Docker构建分析环境，安装和使用包括HISAT2、samtools、fastqc以及trimmomatic在内的生物信息学软件的过程中，小组花费了大量的时间查阅帮助文档，了解参数的使用方法以及文件的格式要求。
- 对于并行计算和系统资源管理不熟悉。
  		在尝试理解如何进行有效的计算以及如何查看和管理系统资源（如CPU和内存）使用的过程中遇到了一些困难。在没有开启hisat2多线程选项的时候，将一组数据比对到参考基因组需要花费大量的时间，在后续对六组数据进行比对时，大量的时间被花费在等待数据运算上。
- 对生物信息学的名词缺乏认知。
  		由于小组中并没有相关专业的同学，在对数据进行分析的时候无法理解名词的含义。使用fastqc获取质量控制报告后，只能对部分warning以及error信息进行相对应的处理。在最后的差异表达分析步骤中，也无法将计算得到的结果与生物学中的基因表达机制很好地联系起来。

## 六、小组成员分工

陈彦宁：Dockerfile，镜像构建与脚本运行，报告撰写

刘雅婷：差异表达分析脚本与结果展示，报告撰写

邵逸飞：数据集与方法，shell脚本，报告撰写

## 七、参考文献

[1]Love, M. I., Huber, W., & Anders, S. l(2014). Moderated estimation of fold change and dispersion for RNA-seq data with DESeq2. Genome Biology, 15(12), 550. doi: 10.1186/s13059-014-0550-8
[2]Pertea, M., Kim, D., Pertea, G. *et al.* Transcript-level expression analysis of RNA-seq experiments with HISAT, StringTie and Ballgown. *Nat Protoc* **11**, 1650–1667 (2016). https://doi.org/10.1038/nprot.2016.095

## 附录

### Dockerfile

```dockerfile
FROM continuumio/anaconda3
LABEL maintainer="2022-2023-2_BIO2503_Group9"

RUN conda config --add channels bioconda

RUN apt-get update && apt-get install -y \
    samtools \
    r-base

WORKDIR /tools

# 安装sratoolkit
RUN wget https://ftp-trace.ncbi.nlm.nih.gov/sra/sdk/current/sratoolkit.current-ubuntu64.tar.gz \
    && tar -zxvf sratoolkit.current-ubuntu64.tar.gz \
    && rm sratoolkit.current-ubuntu64.tar.gz

ENV PATH="/tools/sratoolkit.3.0.5-ubuntu64/bin:${PATH}"

# 安装fastqc
RUN conda install -y fastqc

# 安装trimmomatic
RUN conda install -y trimmomatic

# 安装hisat2 
RUN conda install -y hisat2

# 安装subread以使用featureCounts
RUN wget https://nchc.dl.sourceforge.net/project/subread/subread-2.0.3/subread-2.0.3-Linux-x86_64.tar.gz \ 
    && tar xzf subread-2.0.3-Linux-x86_64.tar.gz \
    && rm subread-2.0.3-Linux-x86_64.tar.gz

ENV PATH="/tools/subread-2.0.3-Linux-x86_64/bin:${PATH}"

COPY ./diff_exp_analysis.R /scripts/diff_exp_analysis.R
COPY ./diff_exp_analysis.sh /scripts/diff_exp_analysis.sh

RUN chmod +x /scripts/diff_exp_analysis.R
RUN chmod +x /scripts/diff_exp_analysis.sh

# 安装所需的R包和依赖
RUN R -e "install.packages(c('DESeq2', 'dplyr', 'ggpubr', 'pheatmap', 'ggplot2'), repos='http://cran.us.r-project.org')"

# 运行容器时，默认执行的命令
CMD ["/bin/bash"]

```

### 项目核心代码

```R
library(DESeq2)
library(dplyr)
#导入counts数据矩阵，以行为基因，列为样本
count <- read.delim("./Martrix.txt",header=TRUE,row.names=1)
## 过滤在所有重复样本中小于1的基因
count <- count[rowMeans(count)>1,]
data <- read.delim("./sample_info.txt",header = TRUE,row.names = 1)
data[,1] <- as.factor(data$condition)
all(rownames(data) %in% colnames(count))
all(rownames(data) == colnames(count))
dds <-  DESeqDataSetFromMatrix(countData = count,colData = data,design = ~ condition)
dim(dds)
dds <- dds[rowSums(counts(dds)) > 1,]
nrow(dds) 
dep <- DESeq(dds)
res <- results(dep)
diff = res
diff <- na.omit(diff) 
dim(diff)
diff
write.csv(diff,"./all_diff.csv")
#进一步筛选差异基因，使用Padj值和log2FC进行筛选
foldChange = 1
padj = 0.05
diffsig <- diff[(diff$pvalue < padj & abs(diff$log2FoldChange) > foldChange),]
dim(diffsig)
diffsig
write.csv(diffsig, "./All_diffsig.csv")
setwd(".")
count <- read.delim("./Martrix.txt",header=T,row.names=1)
DEG_data <- read.csv("./all_diff.csv",header = T,row.names = 1)

#绘制火山图
library(ggpubr) 
DEG_data$logP <- -log10(DEG_data$padj)
#基因分为三类:notsig，up，down
DEG_data$Group <- "notsig"
DEG_data$Group[which((DEG_data$padj< 0.05) & DEG_data$log2FoldChange > 1)] = "up"
DEG_data$Group[which((DEG_data$padj < 0.05) & DEG_data$log2FoldChange < -1)] = "down"
table(DEG_data$Group)

#对差异表达基因调整后的p值进行排序
DEG_data <- DEG_data[order(DEG_data$padj),]

up_label <- head(DEG_data[DEG_data$Group =="up",],5)
down_label <- head(DEG_data[DEG_data$Group == "down",],5)


deg_label_gene <- data.frame(gene = c(rownames(up_label),rownames(down_label)),
                        label = c(rownames(up_label),rownames(down_label)))


DEG_data$gene <- rownames(DEG_data)
DEG_data <- merge(DEG_data,deg_label_gene,by = 'gene',all = T)

ggscatter(DEG_data,x ="log2FoldChange",y = "logP",color = "Group",
            palette = c("green","gray","red"),
            label = DEG_data$label,
            repel = T,
            ylab = "-log10(Padj)",
            size = 2) +
theme(element_line(size = 0),element_rect(size = 1.5))+ 
scale_y_continuous(limits = c(0,35))+
scale_x_continuous(limits = c(-15,15))+
geom_hline(yintercept = 1.3,linetype = "dashed")+
geom_vline(xintercept = c(-2,2),linetype = "dashed")

#绘制热图
library(pheatmap)
#筛选差异基因，使用Padj值和LogFc筛选
diff <- DEG_data
foldChange = 1
padj = 0.05
diffsig <- diff[(diff$pvalue < padj & abs(diff$log2FoldChange) > foldChange),]
dim(diffsig)

diff_expr <- count[match(diffsig$gene,rownames(count)),]

##添加标签信息，一共有6个样本，分别为3个实验组和3个对照组
annotation_col <- data.frame(Group = factor(c(rep("Green",3), rep("Purple",3))))
rownames(annotation_col) <- colnames(diff_expr)

diff_expr <- scale(diff_expr,center = F)

pheatmap(diff_expr,
        annotation_col = annotation_col,
        color = colorRampPalette(c("blue","white","red"))(50),
        cluster_cols = F,
        show_rownames = T,
        show_colnames = T,
        scale = "row", 
        fontsize = 2,
        fontsize_row = 6,
        fontsize_col = 6,
        border = FALSE,
        treeheight_row=100,
        cellwidth = 9, cellheight = 9,
        display_numbers = TRUE,
        number_color = "black",
        number_format = "%.2f",
        legend_breaks = c(-1:1),
        legend = T,
        width = 200,
        height = 500)


com1 <- prcomp(as.matrix(t(diff_expr)), center = FALSE, scale = FALSE)
summary(com1)
df <- as.data.frame(com1$x)
head(df)

sample <- as.data.frame(row.names(df))
names(sample) <- "sample" 
df <- data.frame(df,rownames(df))
names(df)[7] <- "sample"
head(df)

df$type <- ""
df$type <- c(rep("green",3),rep("purple",3))
ggplot(data = df,aes(x=PC1,y=PC2,color= sample))+
        stat_ellipse(aes(fill=type),
                type = "norm", geom ="polygon",alpha=0.2,color=NA)+
                geom_point()+labs(x=xlab,y=ylab,color="")+guides(scale="none")
```

### shell脚本

```bash
#!/bin/bash

# 指定工作目录
WORK_DIR=$1
cd $WORK_DIR

# 工作目录结构
# - 参考基因组文件fna和注释文件gff
# - reference_index（运行中创建）
# - 多个下载好的SRR文件夹
#   - SRA文件
#   - FILENAME_QC_report_results(运行中创建)
#   - FILENAME_QC_results（运行中创建）
#   - FILENAME_mapping_results（运行中创建）
# - mapping_results（运行中创建）

mkdir -p mapping_results

# 指定参考基因组文件和注释文件
GENOME=GCF_000001635.27_GRCm39_genomic.fna
GFF=GCF_000001635.27_GRCm39_genomic.gff

# 使用参考基因组建立HISAT2索引
if [ ! -e "reference_index.1.ht2" ]; then
    echo "Index not found, creating..."
    hisat2-build $GENOME reference_index
else
    echo "Index found, skipping index building step."
fi

# 对每个sra文件进行质量控制分析和修剪
for  FOLDERNAME in SRR*/
do  
    FILENAME="${FOLDERNAME%/}"
    cd $FILENAME

    # 创建文件夹,储存流程中得到的一些文件

    mkdir -p "${FILENAME}_QC_report_results"
    mkdir -p "${FILENAME}_QC_results"
    mkdir -p "${FILENAME}_mapping_results"


    # sra文件转换为fastq文件
    fastq-dump --split-3  "${FILENAME}.sra"
    
    # fastqc质控报告
    # fastqc  -t 12 -o "${FILENAME}_QC_report_results" $Seq1 $Seq2

    # Trimmomatic修剪，这里假定为双端测序
    trimmomatic PE -phred33 "${FILENAME}_1.fastq" "${FILENAME}_2.fastq" \
    "${FILENAME}_QC_results/${FILENAME}_1.trim.fastq" "${FILENAME}_QC_results/${FILENAME}_1.unpaired.trim.fastq" \
    "${FILENAME}_QC_results/${FILENAME}_2.trim.fastq" "${FILENAME}_QC_results/${FILENAME}_2.unpaired.trim.fastq" \
    HEADCROP:15 LEADING:3 TRAILING:3 SLIDINGWINDOW:4:15 MINLEN:36

    # 使用HISAT2比对到参考基因组，得到sam文件
    hisat2 -p 8 -x "../reference_index" -1 "${FILENAME}_QC_results/${FILENAME}_1.trim.fastq" -2 "${FILENAME}_QC_results/${FILENAME}_2.trim.fastq" \
    -S "${FILENAME}_mapping_results/${FILENAME}_mapping.sam"


    cd "${FILENAME}_mapping_results"
    samtools view -bS "${FILENAME}_mapping.sam" > "${FILENAME}_mapping.bam"
    samtools sort "${FILENAME}_mapping.bam" -o "${FILENAME}_mapping_sorted.bam"
    mv "${FILENAME}_mapping_sorted.bam" ../../mapping_results

    # 回到主工作目录
    cd ../
    cd ../
done

# 使用featureCounts计算基因表达矩阵
cd $mapping_results
featureCounts -a $GFF -p -g gene -o Martrix.txt /*_mapping_sorted.bam

# 使用R语言脚本进行差异表达分析
Rscript diff_exp_analysis.R
```
